<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Week 11 Color Tracking Web cam! This week, I decided to tackle working with the ESP32 Cam and colortrack with OpenCV.js. Important notes included engaging the reset button onboard while connecting, and disconnecting the ground and GPIO pins after uploading the code. Once I had the program and board set up and working, it was time to manipulate the OpenCV application! It was difficult at first to set a good mask to track my blue-colored object.'><title>Week 11</title>

<link rel='canonical' href='https://juhye-m.github.io/ps70/posts/week11/'>

<link rel="stylesheet" href="/ps70/scss/style.min.css"><meta property='og:title' content='Week 11'>
<meta property='og:description' content='Week 11 Color Tracking Web cam! This week, I decided to tackle working with the ESP32 Cam and colortrack with OpenCV.js. Important notes included engaging the reset button onboard while connecting, and disconnecting the ground and GPIO pins after uploading the code. Once I had the program and board set up and working, it was time to manipulate the OpenCV application! It was difficult at first to set a good mask to track my blue-colored object.'>
<meta property='og:url' content='https://juhye-m.github.io/ps70/posts/week11/'>
<meta property='og:site_name' content='JuHye Mun'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' />
<meta name="twitter:title" content="Week 11">
<meta name="twitter:description" content="Week 11 Color Tracking Web cam! This week, I decided to tackle working with the ESP32 Cam and colortrack with OpenCV.js. Important notes included engaging the reset button onboard while connecting, and disconnecting the ground and GPIO pins after uploading the code. Once I had the program and board set up and working, it was time to manipulate the OpenCV application! It was difficult at first to set a good mask to track my blue-colored object.">
    </head>
    <body class="article-page keep-sidebar">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "auto");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.body.dataset.scheme = 'dark';
        } else {
            document.body.dataset.scheme = 'light';
        }
    })();
</script><div class="container main-container flex on-phone--column compact ">
            <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            <figure class="site-avatar">
                
                    
                    
                    
                        
                        <img src="/ps70/img/avatar_hue776a334b902d7828bf5c7a8aa11ccb3_243528_300x0_resize_q75_box.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                

                
                    <span class="emoji">ðŸ‘¾</span>
                
            </figure>
        
        <h1 class="site-name"><a href="https://juhye-m.github.io/ps70/">JuHye Mun</a></h1>
        <h2 class="site-description">Blog for PS70</h2>
    </header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/ps70/'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/ps70/about'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        

        
    </ol>
</aside>

            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <h2 class="article-title">
        <a href="/ps70/posts/week11/">Week 11</a>
    </h2>

    </div>
</header>

    <section class="article-content">
    <h2 id="week-11">Week 11</h2>
<h2 id="color-tracking-web-cam">Color Tracking Web cam!</h2>
<p>This week, I decided to tackle working with the ESP32 Cam and colortrack with OpenCV.js. Important notes included engaging the reset button onboard while connecting, and disconnecting the ground and GPIO pins after uploading the code. Once I had the program and board set up and working, it was time to manipulate the OpenCV application! It was difficult at first to set a good mask to track my blue-colored object. I used part of a switch controller to track, because it was a bright blue. To help be figure out the settings for the RGB values, I used this <a class="link" href="https://www.rapidtables.com/web/color/RGB_Color.html"  target="_blank" rel="noopener"
    >RGB Color Picker</a>. Though it took a while, ultimately, the colortracking worked!</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe loading="lazy" src="https://www.youtube.com/embed/g9m6Zp3z3As" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>Then, I wanted to customize this program so that it outputs a music note when the program detects that the object is in a certain location. There is a lot to build open this, such as changing pitch as the colored object moves across the screen. This could be a cool instrument achieved with just a glove! MIDI could be integrated as well.</p>
<p>I did more research for what I could explore with the ESP32 webcam, and came across this <a class="link" href="https://pgaleone.eu/tensorflow/opencv/playerctl/2020/03/26/facectrl-control-media-player-face/"  target="_blank" rel="noopener"
    >Python program that plays music when it detects your face</a>.</p>
<p>Though not ESP32-specific, in general applications, I also found a [research paper<a class="link" href="/research.pdf" ></a> on hand gesture recognition, which also logs differences in detection based on camera used, depth of field, and backgrounds. This would be a great place for people to learn more if they are interested in object tracking.</p>
<h2 id="capacitive-touch-midi-controller">Capacitive Touch Midi Controller</h2>
<p>I wrote custom code to measure capacitive touch and turn that data into midi data to use in a DAW!
First, I set up my circuit like so (this is something we went over in earlier weeks):</p>
<p><figure style="flex-grow: 133; flex-basis: 320px">
		<a href="/ps70/posts/week11/IMG_7223.jpg" data-size="4032x3024"><img src="/ps70/posts/week11/IMG_7223.jpg"
				srcset="/ps70/posts/week11/IMG_7223_hu48f193d71a5aac46da188c6e954a6837_2683262_480x0_resize_q75_box.jpg 480w, /ps70/posts/week11/IMG_7223_hu48f193d71a5aac46da188c6e954a6837_2683262_1024x0_resize_q75_box.jpg 1024w"
				width="4032"
				height="3024"
				loading="lazy"
				alt="Capacitive sensor">
		</a>
		
		<figcaption>Capacitive sensor</figcaption>
		
	</figure></p>
<p>The idea was that when the sensor outputs beyond a certain threshold, a midi note would be sent as output. When the capacitive sensor is below a certain threshold, the midi note is no longer playing. The capacitive sensor has more flexibility and versatility than the button midi circuit I built last week. This is because copper tape capacitive sensoring is not a binary, but is a function of how much resistance I am putting on the tape! Because of this, I could control velocity of my midi output. (note: velocity in the context of MIDI is a synonym to loudness). I also accounted for this in my code. 127 represents the loudest a midi note can be tagged for. 0 is the smallest. My approach was to first test the range of numbers outputted by the capacitive sensor, and wrote in threshold values according to what was reasonable. For the current setup, I decided to use 40000 as the high threshold, 20000 as a medium threshold, and 1000 as a low threshold. These would in turn represent high, low, and medium velocities, respectfully. These numbers were set to variables so that the threshold values can be easily manipulated based on the sensor sensitivity.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;CapacitiveSensor.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
CapacitiveSensor Sensor <span style="color:#f92672">=</span> CapacitiveSensor(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">5</span>);  <span style="color:#75715e">// 7 is charge pin.  5 is sense pin.
</span><span style="color:#75715e"></span>byte noteON <span style="color:#f92672">=</span> <span style="color:#ae81ff">144</span>; <span style="color:#75715e">//note on command
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">long</span> currentState <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">long</span> lastState <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span>(){
  Serial.begin(<span style="color:#ae81ff">115200</span>); <span style="color:#75715e">//initialize Serial connection
</span><span style="color:#75715e"></span>}
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>(){
  <span style="color:#66d9ef">long</span> sensorValue <span style="color:#f92672">=</span> Sensor.capacitiveSensor(<span style="color:#ae81ff">1000</span>);
  <span style="color:#66d9ef">long</span> high <span style="color:#f92672">=</span> <span style="color:#ae81ff">40000</span>;
  <span style="color:#66d9ef">long</span> med <span style="color:#f92672">=</span> <span style="color:#ae81ff">20000</span>;
  <span style="color:#66d9ef">long</span> low <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>;
  currentState <span style="color:#f92672">=</span> sensorValue;
  <span style="color:#66d9ef">if</span> (currentState <span style="color:#f92672">&gt;</span> high  <span style="color:#f92672">&amp;&amp;</span> lastState <span style="color:#f92672">&lt;</span> low){
    MIDImessage(noteON, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">127</span>); <span style="color:#75715e">//turn note 60 on with 127 velocity
</span><span style="color:#75715e"></span>    delay(<span style="color:#ae81ff">200</span>); <span style="color:#75715e">// Debounce
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (currentState <span style="color:#f92672">&gt;</span> med  <span style="color:#f92672">&amp;&amp;</span> (lastState <span style="color:#f92672">&lt;</span> low){
    MIDImessage(noteON, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">80</span>); <span style="color:#75715e">//turn note 60 on with 127 velocity
</span><span style="color:#75715e"></span>    delay(<span style="color:#ae81ff">200</span>); <span style="color:#75715e">// Debounce
</span><span style="color:#75715e"></span>  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(currentState <span style="color:#f92672">&lt;=</span> high  <span style="color:#f92672">&amp;&amp;</span> lastState <span style="color:#f92672">&gt;=</span> low){
    MIDImessage(noteON, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">0</span>); <span style="color:#75715e">//turn note 60 off
</span><span style="color:#75715e"></span>    delay(<span style="color:#ae81ff">20</span>);
  }
  lastState <span style="color:#f92672">=</span> currentState;

<span style="color:#75715e">//  Serial.println(sensorValue); // Debugging
</span><span style="color:#75715e"></span> 
}
<span style="color:#75715e">//send MIDI message
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> MIDImessage(byte command, byte data1, byte data2) {
  Serial.write(command);
  Serial.write(data1);
  Serial.write(data2);
}
</code></pre></div><p>The serial midi program I ran is the same code as last week&rsquo;s. You can find it <a class="link" href="https://juhye-m.github.io/ps70/posts/week-10/"  target="_blank" rel="noopener"
    >here, in week 10</a>.</p>
<p>My circuit and baseline code works. I can test the output values by printing the sensor values to the serial monitor. I ran the serial to midi converter, and hooked it up to my Macbook audio input bus. I then opened my DAW, and it almost works!</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe loading="lazy" src="https://www.youtube.com/embed/wJ-ZqfLPNT8" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>However, for some reason, this midi data doesn&rsquo;t &ldquo;save&rdquo;, nor does it produce sound. However, it is clearly detecting the midi notes. I have yet to debug this.</p>
<h2 id="miscellaneous">Miscellaneous</h2>
<p>I wanted to make my terminal more visible when recording a demo video and was planning on switching to &ldquo;dark mode&rdquo;. Turns out, you can customize the mac terminals even more! Here&rsquo;s my custom terminal inspired by an artist I like.</p>
<p><figure style="flex-grow: 112; flex-basis: 270px">
		<a href="/ps70/posts/week11/rose.jpg" data-size="3024x2681"><img src="/ps70/posts/week11/rose.jpg"
				srcset="/ps70/posts/week11/rose_hu1df62645cc6a48d4c9a3876818980744_1169774_480x0_resize_q75_box.jpg 480w, /ps70/posts/week11/rose_hu1df62645cc6a48d4c9a3876818980744_1169774_1024x0_resize_q75_box.jpg 1024w"
				width="3024"
				height="2681"
				loading="lazy"
				alt="RosÃ© terminal">
		</a>
		
		<figcaption>RosÃ© terminal</figcaption>
		
	</figure></p>

</section>


    <footer class="article-footer">
    

    </footer>

    
</article>

     
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2021 JuHye Mun
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="2.0.1">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css">

            </main>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"
    integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin="anonymous"></script><script type="text/javascript" src="/ps70/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
